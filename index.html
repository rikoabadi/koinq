<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0d0f14" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; connect-src 'self' https://bsc-dataseed.binance.org https://bsc-dataseed1.binance.org https://bsc-dataseed2.binance.org https://bsc-dataseed3.binance.org https://forno.celo.org https://rpc.ankr.com https://api.bscscan.com https://api.celoscan.io https://explorer.celo.org https://celo.blockscout.com https://accounts.api.cx.metamask.io; img-src 'self' data:; object-src 'none'; base-uri 'self'; form-action 'self';" />
  <title>KoinQ â€” Crypto Wallet</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<!-- ===================== TOAST ===================== -->
<div id="toast-container"></div>

<!-- ===================== LOGIN SCREEN ===================== -->
<div id="login-screen">
  <div class="login-card">
    <div class="login-logo">
      <span class="logo-icon">ğŸ”</span>
      <h1>Koin<span>Q</span></h1>
      <p>Your deterministic crypto wallet</p>
    </div>

    <div class="login-form">
      <!-- Step 1: Master Password -->
      <div>
        <label for="password-input">â‘  Master Password</label>
        <div class="input-group">
          <input
            class="input"
            id="password-input"
            type="password"
            placeholder="Enter your master password"
            autocomplete="current-password"
          />
          <button class="input-icon" id="toggle-password" type="button" title="Show/hide password">ğŸ‘</button>
        </div>
      </div>

      <!-- Step 2: Key File -->  
      <div>
        <label>â‘¡ Key File Hash</label>

        <!-- Tab toggle -->
        <div class="keyfile-tabs" id="keyfile-tabs">
          <button class="kf-tab active" id="tab-upload" type="button">ğŸ“ Upload File</button>
          <button class="kf-tab" id="tab-manual" type="button">âœï¸ Input Hash</button>
        </div>

        <!-- Panel: Upload File -->
        <div id="panel-upload">
          <div class="file-drop-zone" id="file-drop-zone">
            <input type="file" id="key-file-input" class="file-input-hidden" accept="*/*" />
            <div class="file-drop-content" id="file-drop-content">
              <span class="file-drop-icon">ğŸ“</span>
              <span class="file-drop-text">Drop file here or <u>click to browse</u></span>
              <span class="file-drop-hint">Any file â€” ZIP, image, PDF, etc.</span>
            </div>
            <div class="file-selected" id="file-selected-info" style="display:none;">
              <span class="file-sel-icon">âœ…</span>
              <div class="file-sel-detail">
                <div class="file-sel-name" id="file-sel-name">â€“</div>
                <div class="file-sel-hash" id="file-sel-hash">Hashingâ€¦</div>
              </div>
              <button class="file-sel-clear" id="file-clear-btn" title="Remove file">âœ•</button>
            </div>
          </div>
          <!-- Copy hash button (muncul setelah file dipilih) -->
          <button class="btn btn-secondary btn-copy-hash hidden" id="copy-hash-btn" type="button">ğŸ“‹ Copy Hash</button>
        </div>

        <!-- Panel: Input Hash Manual -->
        <div id="panel-manual" style="display:none;">
          <div class="input-group">
            <input
              class="input"
              id="manual-hash-input"
              type="text"
              placeholder="Paste SHA-256 hash here (64 hex chars)"
              autocomplete="off"
              spellcheck="false"
              maxlength="64"
            />
            <button class="input-icon" id="clear-manual-hash" type="button" title="Clear">âœ•</button>
          </div>
          <div id="manual-hash-hint" class="hash-hint-msg"></div>
        </div>

        <p class="file-drop-note">âš  Keep this file (or its hash) safe. Without it, your wallet <strong>cannot be recovered</strong>.</p>
      </div>

      <div id="login-error" class="hidden"></div>

      <button class="btn btn-primary w-full" id="unlock-btn" type="button">
        ğŸ”“ Unlock / Create Wallet
      </button>

      <p class="text-xs text-muted" style="text-align:center; line-height:1.7;">
        Wallet = <strong>Password</strong> + <strong>Key File hash</strong> combined via PBKDF2 + BIP39.<br/>
        Both are required. Losing either means <strong style="color:var(--danger);">permanent loss of access</strong>.
      </p>
    </div>
  </div>
</div>

<!-- ===================== DASHBOARD SCREEN ===================== -->
<div id="dashboard-screen" class="hidden">

  <!-- Header -->
  <header class="dsh-header">
    <div class="logo">Koin<span>Q</span></div>

    <div class="network-switcher">
      <button class="net-btn active" data-net="BSC">BNB</button>
      <button class="net-btn" data-net="CELO">CELO</button>
    </div>

    <div class="header-actions">
      <button class="btn btn-ghost" id="refresh-btn" title="Refresh balances">âŸ³</button>
      <button class="btn btn-ghost" id="logout-btn" title="Lock wallet">ğŸ”’</button>
    </div>
  </header>

  <!-- Body -->
  <div class="dsh-body">

    <!-- Sidebar â€” wallet list -->
    <aside class="dsh-sidebar" id="dsh-sidebar">
      <div class="sidebar-header">
        <h3>My Wallets</h3>
        <button class="btn btn-ghost sidebar-phrase-btn" id="copy-phrase-btn" title="Copy recovery phrase">ğŸ”‘ Phrase</button>
      </div>
      <div class="wallet-list" id="wallet-list"></div>
      <!-- Floating Add Wallet button (inside sidebar on mobile) -->
      <div class="fab-wrap">
        <button class="fab" id="add-wallet-fab" title="Add wallet">ï¼‹ Add Wallet</button>
      </div>
    </aside>

    <!-- Main panel -->
    <main class="dsh-main" id="dsh-main">

      <!-- Back button (mobile only) -->
      <button class="btn btn-ghost" id="back-btn">â† Back</button>

      <!-- Address card -->
      <div class="address-card">
        <div class="address-card-header">
          <h3>Address</h3>
          <button class="btn btn-ghost" id="copy-address-btn" title="Copy address">ğŸ“‹ Copy</button>
        </div>
        <div class="address-full" id="main-address-full">â€“</div>
      </div>

      <!-- Balances -->
      <div class="balance-grid" id="balance-grid"></div>

      <!-- Action bar -->
      <div class="action-bar">
        <button class="btn btn-primary" id="send-btn">â†‘ Send USDT</button>
      </div>

      <!-- Transactions -->
      <div class="tx-section">
        <div class="tx-section-header">
          <h3>Transactions</h3>
        </div>
        <div class="tx-list" id="tx-list">
          <div class="tx-empty">Select a wallet to view transactions</div>
        </div>
      </div>

    </main>
  </div>
</div>

<!-- ===================== SEND MODAL ===================== -->
<div id="send-modal-overlay" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <h3 id="send-modal-title">Send USDT</h3>
      <button class="modal-close" id="send-modal-close">âœ•</button>
    </div>

    <!-- Step 1: Input -->
    <div id="send-step-input" class="modal-form">
      <div class="form-field">
        <label for="send-to">Recipient Address</label>
        <input
          class="input"
          id="send-to"
          type="text"
          placeholder="0xâ€¦"
          autocomplete="off"
          spellcheck="false"
        />
      </div>

      <div class="form-field">
        <label for="send-amount">Amount (USDT)</label>
        <div class="amount-input-wrap">
          <input
            class="input"
            id="send-amount"
            type="number"
            min="0"
            step="any"
            placeholder="0.00"
          />
          <span class="amount-symbol">USDT</span>
        </div>
      </div>

      <div class="modal-info">
        <strong>From:</strong> <span id="modal-from-addr">â€“</span><br/>
        Network: <strong id="modal-network-name">â€“</strong> &nbsp;|&nbsp; USDT will be sent (not native coin).
      </div>

      <div id="send-status" class="hidden"></div>

      <button class="btn btn-primary w-full" id="dry-run-btn">ğŸ” Simulate Transfer</button>
    </div>

    <!-- Step 2: Dry Run Preview -->
    <div id="send-step-preview" class="modal-form hidden">
      <div class="dry-run-box" id="dry-run-result"></div>
      <div id="send-status-preview" class="hidden"></div>
      <div class="modal-action-row">
        <button class="btn btn-secondary" id="dry-run-back-btn">â† Back</button>
        <button class="btn btn-primary" id="send-confirm-btn">âœ“ Confirm Send USDT</button>
      </div>
    </div>
  </div>
</div>

<!-- ===================== PHRASE MODAL ===================== -->
<div id="phrase-modal-overlay" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <h3>ğŸ”‘ Copy Recovery Phrase</h3>
      <button class="modal-close" id="phrase-modal-close">âœ•</button>
    </div>
    <div class="modal-form">
      <p class="phrase-modal-desc">Enter your master password to confirm, then your 24-word recovery phrase will be copied to clipboard.</p>
      <div class="form-field">
        <label for="phrase-pwd-input">Master Password</label>
        <div class="input-group">
          <input
            class="input"
            id="phrase-pwd-input"
            type="password"
            placeholder="Enter your password"
            autocomplete="current-password"
          />
          <button class="input-icon" id="phrase-toggle-pwd" type="button" title="Show/hide password">ğŸ‘</button>
        </div>
      </div>
      <div id="phrase-status" class="hidden"></div>
      <button class="btn btn-primary w-full" id="phrase-confirm-btn">ğŸ“‹ Copy Phrase to Clipboard</button>
    </div>
  </div>
</div>

<!-- ===================== LOCAL LIBRARIES ===================== -->
<script src="js/ethers.umd.min.js"></script>
<script src="js/app.js"></script>

</body>
</html>
